<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>AR English Eat</title>

<script src="https://cdn.jsdelivr.net/npm/@mediapipe/face_mesh/face_mesh.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js"></script>

<style>
body{margin:0;background:black;overflow:hidden}
canvas{position:absolute;top:0;left:0}
#hud{position:fixed;top:10px;left:10px;color:white;font:20px sans-serif}
</style>
</head>

<body>
<div id="hud">
  <div id="q">Open your mouth!</div>
  <div id="score">Score: 0</div>
</div>

<video playsinline style="display:none"></video>
<canvas id="c"></canvas>

<script>
const video=document.querySelector("video");
const c=document.getElementById("c");
const ctx=c.getContext("2d");

let score=0;
let word={x:200,y:100,t:"EAT"};
let mouthOpen=false;

function resize(){
  c.width=innerWidth;
  c.height=innerHeight;
}
resize(); addEventListener("resize",resize);

const face=new FaceMesh({
  locateFile:f=>`https://cdn.jsdelivr.net/npm/@mediapipe/face_mesh/${f}`
});
face.setOptions({maxNumFaces:1});

face.onResults(r=>{
  if(!r.multiFaceLandmarks) return;
  const m=r.multiFaceLandmarks[0];
  const u=m[13], l=m[14];
  mouthOpen=Math.hypot(u.x-l.x,u.y-l.y)>0.03;

  draw();
});

const cam=new Camera(video,{
  onFrame:async()=>face.send({image:video}),
  width:640,height:480
});
cam.start();

function draw(){
  ctx.clearRect(0,0,c.width,c.height);
  ctx.save();
  ctx.scale(-1,1);
  ctx.drawImage(video,-c.width,0,c.width,c.height);
  ctx.restore();

  ctx.fillStyle="white";
  ctx.beginPath();
  ctx.arc(word.x,word.y,40,0,Math.PI*2);
  ctx.fill();
  ctx.fillStyle="black";
  ctx.textAlign="center";
  ctx.textBaseline="middle";
  ctx.font="bold 20px sans-serif";
  ctx.fillText(word.t,word.x,word.y);

  if(mouthOpen){
    score++;
    word.x=Math.random()*c.width;
    word.y=Math.random()*c.height;
    document.getElementById("score").innerText="Score: "+score;
  }
}
</script>
</body>
</html>
