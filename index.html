<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, maximum-scale=1.0">
    <title>AR English Eat - M.1 (Level Up)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/face_mesh/face_mesh.js" crossorigin="anonymous"></script>
    <script src="https://cdn.sheetjs.com/xlsx-0.20.1/package/dist/xlsx.full.min.js"></script>
   
    <style>
        body {
            overscroll-behavior: none;
            background-color: #1a202c;
        }
        canvas { width: 100%; height: 100%; transform: scaleX(-1); }
        @keyframes spin { to { transform: rotate(360deg); } }
        .loader {
            border: 4px solid rgba(255, 255, 255, 0.3); border-radius: 50%;
            border-top: 4px solid #a855f7; width: 40px; height: 40px;
            animation: spin 1s linear infinite;
        }
        .pulse-ring { box-shadow: 0 0 0 0 rgba(168, 85, 247, 0.7); animation: pulse-purple 1.5s infinite; }
        @keyframes pulse-purple {
            0% { transform: scale(0.95); box-shadow: 0 0 0 0 rgba(168, 85, 247, 0.7); }
            70% { transform: scale(1); box-shadow: 0 0 0 20px rgba(168, 85, 247, 0); }
            100% { transform: scale(0.95); box-shadow: 0 0 0 0 rgba(168, 85, 247, 0); }
        }
        .scroll-content::-webkit-scrollbar { width: 8px; }
        .scroll-content::-webkit-scrollbar-track { background: #2d3748; border-radius: 4px; }
        .scroll-content::-webkit-scrollbar-thumb { background: #4b5563; border-radius: 4px; }
        @keyframes float { 0% { transform: translateY(0px); } 50% { transform: translateY(-10px); } 100% { transform: translateY(0px); } }
        .floating { animation: float 3s ease-in-out infinite; }
    </style>
</head>
<body class="h-screen w-screen overflow-hidden font-sans text-white select-none">
    <div id="game-container" class="relative w-full h-full flex justify-center items-center bg-gray-900">
       
        <video class="hidden" playsinline autoplay muted></video>
        <canvas id="output-canvas" class="absolute inset-0 w-full h-full object-cover"></canvas>
        <div id="ui-layer" class="absolute inset-0 pointer-events-none flex flex-col justify-between z-10 p-4">
            <div id="hud" class="bg-black/60 backdrop-blur-sm rounded-2xl p-4 text-center border border-white/10 transition-opacity duration-300 pointer-events-auto">
                <div id="user-info-display" class="hidden text-xs text-gray-400 mb-1 flex justify-between px-2">
                    <span id="display-name">Guest</span>
                    <span id="display-number">#00</span>
                </div>
                <div class="flex justify-center items-center gap-3 mb-2">
                    <div id="question-text" class="text-yellow-400 text-xl md:text-2xl font-bold drop-shadow-md">Loading...</div>
                    <button onclick="readQuestion()" class="bg-white/20 hover:bg-white/40 text-white rounded-full p-2 w-10 h-10 flex items-center justify-center transition shadow-lg active:scale-90" title="Listen">ðŸ”Š</button>
                </div>
                <div class="flex justify-between items-center text-sm md:text-base text-gray-200 px-4">
                    <span id="score-text">Score: 0</span>
                    <span id="status-text" class="text-xs text-gray-400">Open mouth to eat! ðŸ˜²</span>
                </div>
            </div>
            <div id="toast" class="hidden absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 bg-red-500 text-white px-6 py-3 rounded-full shadow-lg z-[80]">Error</div>
        </div>

        <!-- Screens à¹€à¸”à¸´à¸¡à¸—à¸±à¹‰à¸‡à¸«à¸¡à¸” (login, password, admin, speech, tutorial, load, end) à¸„à¸±à¸”à¸¥à¸­à¸à¸¡à¸²à¸—à¸±à¹‰à¸‡à¸«à¸¡à¸”à¹€à¸«à¸¡à¸·à¸­à¸™à¹€à¸”à¸´à¸¡ -->
        <!-- ... (à¸§à¸²à¸‡à¸ªà¹ˆà¸§à¸™ HTML screens à¸—à¸µà¹ˆà¹€à¸«à¸¥à¸·à¸­à¸—à¸±à¹‰à¸‡à¸«à¸¡à¸”à¸ˆà¸²à¸à¹‚à¸„à¹‰à¸”à¹€à¸”à¸´à¸¡à¸‚à¸­à¸‡à¸„à¸¸à¸“à¸•à¸£à¸‡à¸™à¸µà¹‰) ... -->

<script>
// === à¹‚à¸«à¸¡à¸” Offline à¹€à¸•à¹‡à¸¡à¸•à¸±à¸§ - à¸¥à¸š Firebase à¸­à¸­à¸à¸—à¸±à¹‰à¸‡à¸«à¸¡à¸”à¹€à¸žà¸·à¹ˆà¸­ deploy GitHub Pages à¹„à¸”à¹‰à¸‡à¹ˆà¸²à¸¢ ===
// à¹„à¸¡à¹ˆà¸šà¸±à¸™à¸—à¸¶à¸à¸­à¸­à¸™à¹„à¸¥à¸™à¹Œ à¹à¸•à¹ˆ export Excel à¸¢à¸±à¸‡à¹ƒà¸Šà¹‰à¹„à¸”à¹‰à¸›à¸à¸•à¸´

const CONFIG = { mouthThreshold: 0.03, eatDistance: 80, gravity: 2.5, spawnRate: 110 };

const ELEMENTS = {
    video: document.querySelector('video'),
    canvas: document.getElementById('output-canvas'),
    screens: {
        login: document.getElementById('screen-login'),
        password: document.getElementById('screen-password'),
        load: document.getElementById('screen-load'),
        end: document.getElementById('screen-end'),
        speech: document.getElementById('screen-speech'),
        tutorial: document.getElementById('screen-tutorial'),
        admin: document.getElementById('screen-admin')
    },
    ui: {
        loader: document.getElementById('loader-spinner'),
        loadText: document.getElementById('loading-text'),
        controls: document.getElementById('start-controls'),
        question: document.getElementById('question-text'),
        score: document.getElementById('score-text'),
        finalScore: document.getElementById('final-score'),
        toast: document.getElementById('toast'),
        speechTarget: document.getElementById('speech-target-word'),
        speechPhonetic: document.getElementById('speech-phonetic'),
        speechStatus: document.getElementById('speech-status'),
        displayName: document.getElementById('display-name'),
        displayNumber: document.getElementById('display-number'),
        endName: document.getElementById('end-name'),
        endNumber: document.getElementById('end-number'),
        userInfoDisplay: document.getElementById('user-info-display'),
        cheatList: document.getElementById('cheat-list')
    },
    inputs: {
        name: document.getElementById('input-name'),
        number: document.getElementById('input-number'),
        adminPass: document.getElementById('admin-pass-input')
    }
};

const ctx = ELEMENTS.canvas.getContext('2d');

window.gameState = {
    isPlaying: false, score: 0, qIndex: 0, items: [],
    mouthPos: { x: 0, y: 0 }, isMouthOpen: false,
    history: [], cameraReady: false, isWaitingNext: false,
    isSpeechMode: false, pendingScoreItem: null,
    user: { name: "Guest", number: "00" }
};
let state = window.gameState;

// Questions à¹€à¸”à¸´à¸¡ (à¸„à¸±à¸”à¸¥à¸­à¸à¸¡à¸²à¸—à¸±à¹‰à¸‡à¸«à¸¡à¸”)
const questions = [ /* ... à¸§à¸²à¸‡ array questions à¹€à¸”à¸´à¸¡à¸—à¸±à¹‰à¸‡à¸«à¸¡à¸”à¸•à¸£à¸‡à¸™à¸µà¹‰ ... */ ];

// Populate cheat-list (à¹€à¸«à¸¡à¸·à¸­à¸™à¹€à¸”à¸´à¸¡)
ELEMENTS.ui.cheatList.innerHTML = questions.map((q, i) => `
    <div class="bg-gray-700/50 p-3 rounded-lg border border-gray-600/50 text-left">
        <div class="text-yellow-300 font-semibold mb-2">${i+1}. ${q.q}</div>
        <div class="text-sm space-y-1">
            ${q.list.map(t => `<div class="flex items-start gap-2 text-gray-300"><span class="text-purple-400">â€¢</span><span>${t}</span></div>`).join('')}
        </div>
    </div>
`).join('');

// Admin à¹ƒà¸Šà¹‰ password à¹€à¸”à¸´à¸¡ à¹à¸•à¹ˆ table à¸ˆà¸°à¸§à¹ˆà¸²à¸‡ (à¹€à¸žà¸£à¸²à¸°à¹„à¸¡à¹ˆà¸¡à¸µ Firebase)
window.openPasswordModal = () => { /* à¹€à¸”à¸´à¸¡ */ };
window.closePasswordModal = () => { /* à¹€à¸”à¸´à¸¡ */ };
window.checkAdminPassword = () => {
    if (ELEMENTS.inputs.adminPass.value === "1234") {
        closePasswordModal();
        ELEMENTS.screens.admin.classList.remove('hidden'); ELEMENTS.screens.admin.style.display = 'flex';
        document.getElementById('admin-table-body').innerHTML = '<tr><td colspan="4" class="px-4 py-4 text-center text-gray-500">Offline mode: No cloud data</td></tr>';
    } else {
        document.getElementById('pass-error').classList.remove('hidden');
    }
};
window.closeAdminPanel = () => { /* à¹€à¸”à¸´à¸¡ */ };

// Login, export Excel, tutorial à¹€à¸”à¸´à¸¡
window.submitLogin = () => { /* à¹€à¸”à¸´à¸¡ */ };
window.exportToExcel = () => { /* à¹€à¸”à¸´à¸¡ - à¸¢à¸±à¸‡à¸—à¸³à¸‡à¸²à¸™à¸›à¸à¸•à¸´ */ };
window.showTutorial = () => { /* à¹€à¸”à¸´à¸¡ */ };
document.getElementById('tutorial-btn').onclick = () => {
    ELEMENTS.screens.tutorial.classList.add('hidden');
    ELEMENTS.screens.tutorial.style.display = 'none';
    startGame();
};

// Game Logic à¹€à¸”à¸´à¸¡à¸—à¸±à¹‰à¸‡à¸«à¸¡à¸” (loadQuestion, spawnItem, gameLoop, drawWord, handleEat, etc.)
// ... à¸§à¸²à¸‡à¹‚à¸„à¹‰à¸”à¸ªà¹ˆà¸§à¸™à¹€à¸à¸¡à¸—à¸±à¹‰à¸‡à¸«à¸¡à¸”à¹€à¸«à¸¡à¸·à¸­à¸™à¹€à¸”à¸´à¸¡ ...

// à¸¥à¸šà¸«à¸£à¸·à¸­ comment à¸ªà¹ˆà¸§à¸™ Firebase à¸­à¸­à¸à¸—à¸±à¹‰à¸‡à¸«à¸¡à¸”
// window.saveScoreToFirebase = () => { console.log("Offline mode - score not saved to cloud"); };
// window.loadAdminData = () => { /* à¹„à¸¡à¹ˆà¹‚à¸«à¸¥à¸” */ };
// window.exportAllToExcel = () => { alert("Offline mode: Export only your own score"); };

// Speech, readQuestion, MediaPipe à¹€à¸”à¸´à¸¡
// ... à¸§à¸²à¸‡à¸ªà¹ˆà¸§à¸™à¸—à¸µà¹ˆà¹€à¸«à¸¥à¸·à¸­à¹€à¸«à¸¡à¸·à¸­à¸™à¹€à¸”à¸´à¸¡ ...

// Resize à¹ƒà¸«à¹‰ responsive à¸”à¸µà¸‚à¸¶à¹‰à¸™
function resize() {
    ELEMENTS.canvas.width = window.innerWidth;
    ELEMENTS.canvas.height = window.innerHeight;
}
window.addEventListener('resize', resize);
resize();

// à¹€à¸£à¸´à¹ˆà¸¡ camera à¸—à¸±à¸™à¸—à¸µà¸«à¸¥à¸±à¸‡ login (à¹€à¸«à¸¡à¸·à¸­à¸™à¹€à¸”à¸´à¸¡)
</script>
</body>
</html>
